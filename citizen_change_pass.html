<html>
	<head>
		 <!--<script src="http://code.jquery.com/jquery-1.9.1.js"></script>-->
		 <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

		 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>
		<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    	  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

		<style>
			#cardpanel{
				padding-top:20%;
			}
		</style>
		
    </head>  
		 
	
	<body class="grey lighten-2">
		<form name="citi_pass_change">
			<div class="container" id="cardpanel">
			    <div class="card-panel white">
					<h3 class="center">Citizen login</h3>
				    <div class="row">
						<div class="input-field col s12">
						    <input id="pass" type="password" name="pass" class="validate">
						    <label for="password">New Password</label>
						</div>

						<div class="input-field col s12">
						    <input id="confpass" type="password" name="confpass" class="validate">
						    <label for="password">Re-enter Password</label>
						</div>

						</div>
						
						<div class="col s12"> 
                      <button class="btn waves-effect waves-light black" type="submit" value="Change"/>Change
                        <i class="material-icons right">send</i>
                      </button>					  
                    </div>
			        </div>
			    </div>
			</div>
		</form>
		<script type="text/javascript">
				$('form').on('submit', function (e) {	
				 function getQueryVariable(variable) {
          			var query = window.location.search.substring(1);
          			var vars = query.split("&");
          			for (var i=0;i<vars.length;i++) {
            			var pair = vars[i].split("=");
            			if (pair[0] == variable) {
              			return pair[1];
            			}
          			} 
          			alert('Query Variable ' + variable + ' not found');
        		}	
		        e.preventDefault();		
		        var x = document.forms["citi_pass_change"]["pass"].value;
          		if (x == "") {
              		alert("Password required!");
              		return false;
          		}
          		var x = document.forms["citi_pass_change"]["pass"].value;
          		var y = document.forms["citi_pass_change"]["confpass"].value;
          		if (x == y) {
              		alert("Passwords do not match!");
              		return false;
              	var email = getQueryVariable("email");	
          		}
		          $.ajax({
		            type: 'post',
		            //url: 'http://localhost/appon/citizen_login.php',
		            url: 'https://appon.000webhostapp.com/citizen_password_change.php?email='+email,
		            cache: false,
		            data: $('form').serialize(),
		            success: function (response) {
		            	console.log(response);
		            	if (response=="done") {
		            		//alert('Logging in!');
		              		location.href = "citizen_login.html",
		            	}  
		            }
		          });		
		        });
		</script>        
	</body>
</html>
